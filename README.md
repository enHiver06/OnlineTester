# 教师资料验证与合成工具 (Pure Frontend)

## 1. 项目概述
本项目是一个基于浏览器的纯前端图片处理与验证工具，旨在解决教师资料提交过程中的合规性问题。项目无需后端服务器，完全利用客户端计算能力实现图片的格式/尺寸验证、背景自动修复、以及最终展示卡片的合成预览。

## 2. 核心功能特性

### 2.1 双模式验证体系
| 模式 | 验证对象 | 输出物 |
| :--- | :--- | :--- |
| **证件照模式** | 教师证件头像 | 修复后的证件照 + 328x322px 预览卡片 |
| **引导页模式** | 生活照 + 自我介绍 | 修复后的生活照 + 1280x800px 预览卡片 |

### 2.2 核心处理能力
* **智能验证**：自动检测格式、尺寸比例、透明度及文本长度。
* **自动修复**：
    * **背景移除**：基于边缘像素采样的背景自动剔除。
    * **智能裁剪**：非正方形图片自动顶部对齐裁剪。
    * **格式统一**：强制转换并导出为标准 PNG。
* **实时合成**：基于 Canvas 的多图层（背景+人像+前景+文字）实时渲染。

## 3. 验证与业务规则

### 3.1 图片验证标准
| 检查项 | 证件照标准 | 生活照标准 | 备注 |
| :--- | :--- | :--- | :--- |
| **格式** | PNG | PNG | 统一无损格式 |
| **尺寸** | 400 × 400 px | 900 × 1200 px | 严格匹配 |
| **透明度** | 透明背景 | 透明背景 | 透明像素占比 > 0.1% |

### 3.2 文本验证标准（仅生活照模式）
* **最大长度**：59 个字符。
* **计数逻辑**：
    * 中文字符/标点 = 1 字符
    * 英文字母/数字/标点 = 0.5 字符
    * 空格 = 不计入

## 4. 技术架构与实现

### 4.1 技术栈
* **框架**：Next.js 14 (React) + TypeScript
* **样式**：Tailwind CSS
* **核心图形处理**：Native Canvas API
* **部署架构**：静态导出 (SSG)，支持 Vercel/Netlify/Nginx。

### 4.2 核心算法实现

#### A. 背景移除算法 (Pixel Manipulation)
模拟 Python PIL 功能，在浏览器端实现：
1. **采样**：扫描图片四边边缘像素，统计主导颜色（占比≥50%）。
2. **比对**：遍历全图像素，计算与主导色的 RGB 色差。
3. **处理**：色差小于容差值（Tolerance=15）的像素 Alpha 通道置 0。

#### B. 卡片合成逻辑 (Layer Composition)
利用 Canvas API 进行三层堆叠渲染：
1. **Bottom Layer**：绘制底板背景图。
2. **Middle Layer**：
    * 证件照模式：坐标 (99, 12)，尺寸 254×254px。
    * 生活照模式：坐标 (161, 250)，尺寸 300×400px。
3. **Top Layer**：绘制前景装饰图（遮罩/边框）。
4. **Text Layer**（仅生活照）：绘制自我介绍，支持自动换行（Max 3行）。

#### C. 文本长度校验 (Regex)
使用 Unicode 范围进行精准加权计算：
* 汉字/CJK符号/全角字符 (`\u4e00-\u9fff`, `\u3000-\u303f`, `\uff00-\uffef`) 计为 1。
* 其他 ASCII 字符计为 0.5。

## 5. 优势与局限

* **核心优势**：零后端成本、数据隐私安全（本地处理）、无网络延迟、离线可用。
* **已知局限**：复杂背景去除效果弱于服务端 AI 模型；大文件处理依赖客户端设备性能。